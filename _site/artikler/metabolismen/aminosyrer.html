<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vegard Lysne">
<meta name="dcterms.date" content="2014-06-11">

<title>Aminosyre- og proteinsyntese – Frisk og Funksjonell (arkiv)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Frisk og Funksjonell (arkiv)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../artikler.html"> 
<span class="menu-text">Alle poster</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../naeringsstoffer.html"> 
<span class="menu-text">Næringsstoffene</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../metabolismen.html"> 
<span class="menu-text">Metabolismen</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../fysiologi.html"> 
<span class="menu-text">Fysiologi</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../hormonsystemet.html"> 
<span class="menu-text">Hormoner</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../kildekritikk.html"> 
<span class="menu-text">Kildekritikk</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../kosthold-institusjoner.html"> 
<span class="menu-text">Kosthold i helseinstitusjoner</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../om.html"> 
<span class="menu-text">Om bloggen</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Aminosyre- og proteinsyntese</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Metabolismen</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Vegard Lysne </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 11, 2014</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="../../metabolismen.html">Tilbake til artikkelserien om metabolismen</a></p>
<p>Proteiner er kroppens primære byggesteiner, og stort sett alt vev er bygget opp av ulike proteiner. Utover dette har protein også andre funksjoner, deriblant som enzymer og hormoner. Proteiner er bygget opp av aminosyrer, og for at proteinsyntesen skal fungere er vi avhengig av tilstrekkelig tilgang på alle de ulike aminosyrene. Disse kan vi få fra maten vi spiser, og en del av dem kan vi også lage selv. I denne artikkelen skal jeg ta for meg hvordan aminosyresyntesen foregår og hvordan aminosyrene settes sammen til nye proteiner.</p>
<ul>
<li>Les om proteiner&nbsp;og hvordan de fordøyes og tas opp i&nbsp;<a href="../../artikler/naeringsstoffer/protein.html" title="Protein">denne artikkelen</a>.</li>
</ul>
<section id="aminosyrer" class="level2">
<h2 class="anchored" data-anchor-id="aminosyrer">Aminosyrer</h2>
<p>Aminosyrer er den enkleste byggesteinen i proteiner, og for at proteinsyntesen skal opprettholdes må kroppen altså ha tilgang på alle de 20 aminosyrene.&nbsp;Hvis det er for lite av en aminosyre, vil hele proteinsyntesen stoppe opp, noe som kan føre til mangelsykdommer. De essensielle aminosyrene kan kroppen ikke lage selv, og vi er avhengig av å få de i oss via kostholdet. De resterende aminosyrene er betegnet som ikke-essensielle, noe som betyr at kroppen kan lage dem selv. I tillegg har vi en gråsone som kalles betinget essensielle aminosyrer, som kort fortalt betyr at selv om vi normalt sett kan lage tilstrekkelig selv, er det situasjoner der også disse blir essensielle, for eksempel ved enkelte metabolske sykdommer. De 20 aminosyrene er gruppert i tabellen under.</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td><strong>Essensielle</strong></td>
<td><strong>Ikke-essensielle</strong></td>
<td><strong>Betinget essensielle</strong></td>
</tr>
<tr class="even">
<td>Fenylalanin</td>
<td>Alanin</td>
<td>Arginin</td>
</tr>
<tr class="odd">
<td>Isoleucin</td>
<td>Aspartat</td>
<td>Cystein</td>
</tr>
<tr class="even">
<td>Leucin</td>
<td>Aspargin</td>
<td>Glutamin</td>
</tr>
<tr class="odd">
<td>Lysin</td>
<td>Glutamat</td>
<td>Glycin</td>
</tr>
<tr class="even">
<td>Metionin</td>
<td>Serin</td>
<td>Histidin</td>
</tr>
<tr class="odd">
<td>Treonin</td>
<td>&nbsp;</td>
<td>Prolin</td>
</tr>
<tr class="even">
<td>Tryptofan</td>
<td>&nbsp;</td>
<td>Tyrosin</td>
</tr>
<tr class="odd">
<td>Valin</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>En aminosyre er bygget opp av et karbonskjelett med en tilhørende nitrogenholdig aminogruppe, og strukturen kan du se på bildet under. R representerer en funksjonell gruppe, og det er ulike R som skiller de forskjellige aminosyrene fra hverandre.</p>
<p><img src="images/clipboard-1062659921.png" class="img-fluid"></p>
<p>Bilde: Wikipedia[/caption]</p>
</section>
<section id="syntese-av-ikke-essensielle-aminosyrer" class="level2">
<h2 class="anchored" data-anchor-id="syntese-av-ikke-essensielle-aminosyrer">Syntese av ikke-essensielle aminosyrer</h2>
<p>De ikke-essensielle aminosyrene kan kroppen lage selv, enten fra intermediære metabolitter fra for eksempel sitronsyresyklusen eller ved omdanning fra andre aminosyrer.</p>
<section id="alanin-aspartat-og-glutamat---transaminering" class="level3">
<h3 class="anchored" data-anchor-id="alanin-aspartat-og-glutamat---transaminering">Alanin, aspartat og glutamat - transaminering</h3>
<p>Transaminering er prosessen der en aminogruppe overføres fra et molekyl til et annet, ved hjelp av vitamin B6-avhengige aminotransferaser. Dette er en sentral prosess i aminosyrenedbrytning, men noen aminosyrer produseres også på denne måten.</p>
<p>I glykolysen og sitronsyresyklusen finner vi ketosyrene pyruvat, oksaloacetat og α-ketoglutarat. Disse kan ved å motta en aminogruppe fra en annen aminosyre omdannes til henholdsvis aminosyrene alanin, aspartat og glutamat. I denne reaksjonen blir altså aminosyren omdannet til en a-ketosyre, mens a-ketosyren blir omdannet til en aminosyre.</p>
<p><img src="images/clipboard-3590620592.png" class="img-fluid"></p>
</section>
<section id="glutamin-og-aspargin---amideringsreaksjoner" class="level3">
<h3 class="anchored" data-anchor-id="glutamin-og-aspargin---amideringsreaksjoner">Glutamin og aspargin - amideringsreaksjoner</h3>
<p>Noen aminosyrer inneholder to aminogrupper, og kan dermed dannes ved at en aminogruppe overføres fra en annen aminosyre. Dette gjelder for omdanningen av glutamat til glutamin og aspartat til aspargin.</p>
</section>
<section id="prolin-og-arginin-glutamat-som-forløper" class="level3">
<h3 class="anchored" data-anchor-id="prolin-og-arginin-glutamat-som-forløper">Prolin og arginin – glutamat som forløper</h3>
<p>Glutamat produseres som nevnt ved transaminering av α-ketoglutarat, og i tillegg til å kunne omdannes videre til glutamin fungerer glutamat også som forløper for aminosyrene prolin og arginin.</p>
</section>
<section id="tyrosin-dannes-fra-fenylalanin" class="level3">
<h3 class="anchored" data-anchor-id="tyrosin-dannes-fra-fenylalanin">Tyrosin dannes fra fenylalanin</h3>
<p>Tyrosin kan dannes fra den essensielle aminosyren fenylalanin ved hjelp av enzymet fenylalanin hydroksylase. Personer med Føllings sykdom mangler dette enzymet, og kan derfor ikke bryte ned fenylalanin. For disse blir tyrosin derfor en essensiell aminosyre.</p>
<p><img src="images/clipboard-1931111471.png" class="img-fluid"></p>
</section>
<section id="serin-glycin-og-cystein" class="level3">
<h3 class="anchored" data-anchor-id="serin-glycin-og-cystein">Serin, glycin og cystein</h3>
<p>Serin er en aminosyre som i kroppen kan produseres fra en metabolitt som stammer fra nedbrytning av glukose, 3-fosfoglyserat. Serin kan videre konverteres til glycin i en reversibel reaksjon katalysert av det folat- og B6-avhengige serin hydroksymetyltransferase. Dette vil si at serin også kan produseres fra glycin.</p>
<p>Glycin kan på sin side, i tillegg til å produseres fra serin, også produseres fra nedbrytning av aminosyren treonin, fra nedbrytningen av <a href="../../artikler/bioblikk-kolin.html" title="Bioblikk: Andre bioaktive stoffer i mat – Choline">kolin</a>&nbsp;og ikke minst som et biprodukt i syntesen av <a href="../../artikler/bioblikk-karnitin.html" title="Bioblikk – Karnitin">karnitin</a>.</p>
<p>Cystein dannes i en reaksjon der homocystein kobles sammen med serin, som du kan lese mer om i artikkelen om <a href="../../artikler/bioblikk-enkarbonmetabolismen.html" title="Bioblikk: Enkarbonmetabolismen, en introduksjon">enkarbonmetabolismen</a>. Homocystein er et endeprodukt fra metyleringsreaksjoner, og <a href="../../artikler/bioblikk-metyleringssyklus.html" title="Bioblikk: Metyleringssyklus">stammer opprinnelig fra den essensielle aminosyren metionin</a>. Dette forklarer også hvorfor cystein er en betinget essensiell aminosyre, ettersom vi blir avhengig av å få den gjennom kostholdet dersom metionininntaket ikke er tilstrekkelig.</p>
<p><img src="images/clipboard-3479256886.png" class="img-fluid"></p>
</section>
</section>
<section id="proteinsyntese" class="level2">
<h2 class="anchored" data-anchor-id="proteinsyntese">Proteinsyntese</h2>
<p>Aminosyrene fraktes fra blodet og inn i <a href="http://www.friskogfunksjonell.no/cellen/" title="Cellen">cellene</a>. Her inngår de i proteinsyntesen, der nye proteiner bygges opp. Funksjonen til et protein er bestemt av flere ting, blant annet rekkefølgen på aminosyrene. Dette kalles primærstrukturen, og bestemmes av oppskriften som finnes i <a href="http://www.friskogfunksjonell.no/genetiske-og-metabolske-sykdommer-genetikk/" title="Genetiske og metabolske sykdommer – genetikk">den genetiske koden</a> i vårt DNA, der tre og tre baser koder for en aminosyre</p>
<p>Inne i cellekjernen skjer det som kalles transkripsjon, nemlig at informasjonen fra DNA kopieres over på RNA. RNA fraktes ut av cellekjernen og over til ribosomene, der selve proteinsyntesen (translasjon) foregår. Det finnes ulike RNA-typer, som har sine funksjoner i proteinsyntesen:</p>
<ul>
<li><strong>mRNA</strong> binder til ribosomene og fungerer som oppskrift på proteinet</li>
<li><strong>tRNA</strong> binder til en spesifikk aminosyre, og det finnes minst et tRNA til hver aminosyre.</li>
</ul>
<p>Under selve prosessen vil tRNA frakte den riktige aminosyren til ribosomet, som fester aminosyren på det proteinet som holder på å bygges etter oppskriften som står på mRNA. På denne måten hektes en og en aminosyre på hverandre, helt til proteinet er ferdig bygget opp. tRNA inneholder et såkalt antikodon, som består av tre baser som komplementerer den genetiske koden, og slik sørges det for at riktig aminosyre havner på riktig plass i den voksende peptidkjeden. Hvis det ikke er tilgang på alle aminosyrene, vil hele proteinsyntesen stoppe opp, ettersom prosessen vil stoppe opp om den neste aminosyren ikke er tilgjengelig.</p>
<p>I starten av hvert nye protein finner vi metionin. Dette er fordi tRNA for metionin kan binde direkte til ribosomene og initiere selve proteinsyntesen.&nbsp;På slutten av oppskriften for et protein finner vi et stoppkodon, som ikke har komplementære tRNA. Disse stoppkodonene gjenkjennes av såkalte “release factors”, som sørger for at translasjonen stopper opp og det ferdige proteinet slippes fri fra ribosomet.</p>
<p>Bildet under illustrerer proteinsyntesen:</p>
<p><img src="images/clipboard-2609922565.png" class="img-fluid"></p>
<p>Bilde: wikipedia</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>